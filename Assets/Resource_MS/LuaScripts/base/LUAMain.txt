--[[
Author: DWJ
Date: 2021-11-18
Description:LUAMain
--]]
LUAMain={};
function LUAMain:new (o)
  o = o or {}
  setmetatable(o, self)
  self.__index = self
  return o
end
LUAMain.name="luamain"
LUAMain.LuaIdBaseNum=1


require_path = function(className,classPath)
  if CS.NeoOPM.GameEntry.Config.IsEditor then
    return require(classPath)
  else
    return require(className)
  end
end




function pairsSortKey( t,f )
  local a={}
  for k in pairs(t) do
    a[#a+1]=k
  end
  table.sort( a,f )
  local i=0
  return function (  )
    i=i+1
    return a[i],t[a[i]]
  end
end

function LUAMain:clearcache(list )
  local count=list.Count
  if count<=0 then
    return
  end
  count=count-1
  for i=0,count do
    package.loaded[list[i]]=nil
  end
end


----------------------------------------------------------------------
LUAMain._list_behaviour = {}
-- todo 优化：1.去重优化  2.update 优先级处理
function LUAMain:addBehaviour(behaviour)
  if behaviour and self._list_behaviour[behaviour] == nil  then
    self._list_behaviour[behaviour] = behaviour
  end
end

function LUAMain:removeBehaviour(behaviour)
   self._list_behaviour[behaviour] = nil
end

function LUAMain:update(dt,timeScale)
  for i, v in pairs(  self._list_behaviour) do
    if v and v.update then
      v:update(dt,timeScale)
    end
  end
end

function LUAMain:lateUpdate(dt,timeScale)

end



require("MianInit")

--[[package.cpath = package.cpath .. ';C:/Users/dongwenjun/AppData/Roaming/JetBrains/Rider2020.1/plugins/intellij-emmylua/classes/debugger/emmy/windows/x64/?.dll'
local dbg = require('emmy_core')
dbg.tcpConnect('localhost', 8672)]]
