---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by liuyubao.
--- DateTime: 2021/12/23 15:05
---@class BattleEntityContext:SimpleClassUtil
local BattleEntityContext = SimpleClassUtil:class()
function BattleEntityContext:initialize()

end

function BattleEntityContext:init(baseBlackBoard,battleData,battleManager)

    self._baseBlackBoard = baseBlackBoard

    self._battleManager = battleManager

    self._battleData = battleData

    self._list_camp = {
        [Enum_Battle.Camp.CampSelf] = {},
        [Enum_Battle.Camp.CampEnemy] = {},
    }

    self:initCharacters()

    --self:test()
end


--function BattleEntityContext:test()
--    --local base = testBase:new()
--
--    local test_2 = test_2:new()
--    test_2:addList({ x = 1})
--
--    --table.insert( test_2._test_list ,{ x = 1})
--    local test_4 = test_4:new()
--    --test_2:addList(test_4)
--    test_2:addList({ x = 2})
--    --table.insert( test_2._test_list ,{ x = 2})
--    Logger.ErrorTable(test_2._test_list)
--end

function BattleEntityContext:initCharacters()

    local data = self._battleData

    for i, v in pairs(data.team_self.teamMap) do
        local index = i
        local character = BattleCharacter:new(Enum_Battle.Camp.CampSelf,index,self._battleManager,self,v)
        self._list_camp[Enum_Battle.Camp.CampSelf][index] = character
    end

    for i, v in pairs(data.team_enemy.teamMap) do
        local index = i
        self._list_camp[Enum_Battle.Camp.CampEnemy][index] =  BattleCharacter:new(Enum_Battle.Camp.CampEnemy,index,self._battleManager,self,v)
    end

end

function BattleEntityContext:update(dt)
    for camp, _campList in pairs(self._list_camp) do
        for index_pos, character in pairs(_campList) do
            if character and character.update then
                character:update(dt)
            end
        end
    end
end

function BattleEntityContext:getEnemyCamp(camp)
    if camp == Enum_Battle.Camp.CampSelf then
        return  Enum_Battle.Camp.CampEnemy
    else
        return  Enum_Battle.Camp.CampSelf
    end
end

function BattleEntityContext:getEntityListByCamp(camp)
   return self._list_camp[camp] or {}
end
---@return BattleCharacter[]
function BattleEntityContext:getEnemyEntityList(camp)
    local enemyCamp = self:getEnemyCamp(camp)
    return self:getEntityListByCamp(enemyCamp)
end

function BattleEntityContext:getSelfEntityByIndex(camp,index)
    return self:getEntityListByCamp(camp)[index]
end

function BattleEntityContext:getEnemyEntityByIndex(camp,index)
    return self:getEnemyEntityList(camp)[index]
end

return BattleEntityContext