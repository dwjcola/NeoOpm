---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by liuyubao.
--- DateTime: 2021/12/29 11:39
---@class BattleCharacter:SimpleClassUtil
local BattleCharacter = SimpleClassUtil:class()

function BattleCharacter:initialize(campType,index,battleManager,entityContext,heroData,uid)

    self._campType = campType

    self._index_pos = index

    self._battleManager = battleManager

    self._entityContext = entityContext

    self._heroData = heroData

    self._heroId = heroData.heroId

    self._uid = uid
    --BattleLog.error( self._heroId)

    self:init()



end

function BattleCharacter:init()
    local volume_r = 0.5
    local place_r = 0.6
    local dislocation_r = 0
    local detection_r = 0

    local rlist = {6,1}
    local skill_5 = SkillData:new()
    --skill_5._skill_r = rlist[math.random(1,2)]
    skill_5._skill_r = 1
    skill_5._skillType = Enum_Battle.SkillTag.Skill_5
    skill_5._skill_time_cd = 0

    local data = {
        _heroId =  self._heroData.heroId,
        _hp = 1000,
        _campType = self._campType,
        _index_pos = self._index_pos,
        _position = BattleUtils:posMapToVec3(BattleUtils:getPositionByIndex(self._campType == Enum_Battle.Camp.CampSelf,self._index_pos)),
        _alive = true,
        _anger = 0,
        _isUnPutSkill = false,
        _smallSkillIng = false,
        _bigSkillReady = false,
        _isKeyDownBigSkill = false,
        _uid = self._uid,
        _moveSpeed = self._index_pos == 4 and  0.1 or 0.3,
        _skillData = {
           [Enum_Battle.SkillTag.Skill_5] = skill_5
        },
        _volume_r = volume_r,
        _place_r = place_r,
        _dislocation_r = dislocation_r,
        _detection_r = detection_r,
        _isCloseIn = true,
        _orientation = self._campType == Enum_Battle.Camp.CampSelf and Enum_Battle.Orientation.Right or Enum_Battle.Orientation.Left
    }

    local agent = {
        _battleManager =  self._battleManager,
        _entityContext = self._entityContext
    }

    self._logicTree = BehaviourTreeEntity:new({},data,agent)

    self:debugSetting(volume_r,place_r,dislocation_r,detection_r)
end

function BattleCharacter:debugSetting(volume_r,place_r,dislocation_r,detection_r)
    if GameStatic_Battle.General_Grizmo then
        local data = {uid = self._uid,volume_r = volume_r,place_r = place_r,dislocation_r = dislocation_r,detection_r = detection_r}
        EventManager:Dispatch_battle(EventType.Event_Battle_Render_Debug_GizmosCircle,data)
    end

end

function BattleCharacter:getData()
    if self._logicTree and self._logicTree._blackboard then
        return self._logicTree._blackboard
    else
        return {}
    end
end

function BattleCharacter:update(dt)
    if  self._logicTree then
        self._logicTree:execute(dt)
    end
end


return BattleCharacter