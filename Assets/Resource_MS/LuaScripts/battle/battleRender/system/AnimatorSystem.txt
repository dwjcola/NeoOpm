---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by liuyubao.
--- DateTime: 2021/12/30 16:22
---@class AnimatorSystem:ISystem
local AnimatorSystem = SimpleClassUtil:class(ISystem)

function AnimatorSystem:initialize()
    ISystem.initialize(self)
end

function AnimatorSystem:getEventHandleMap()
    return {
        [EventType.Event_Battle_Render_SwitchAni] = "switchAniHandle",
    }
end

function AnimatorSystem:crossFade(animatorComponent,state,isReset,normalizedTransitionDuration)
    if animatorComponent and animatorComponent.animator then
        isReset = isReset or false
        normalizedTransitionDuration = normalizedTransitionDuration or 0.2
        if isReset then
            if state == animatorComponent.aniState then
                animatorComponent.animator:Play(state,0,0)
            else
                animatorComponent.animator:CrossFade(state,normalizedTransitionDuration )
            end
        else
            if state == animatorComponent.aniState then
                return
            else
                animatorComponent.animator:CrossFade(state,normalizedTransitionDuration )
            end
        end
    end
end

function AnimatorSystem:setSpeed(animatorComponent,speed)
    if animatorComponent and animatorComponent.animator and speed then
        animatorComponent.animator.speed = speed
    end
end


function AnimatorSystem:switchAniHandle(data)
    local uid = data.uid
    local aniState = data.aniName
    local isReset = data.isReset
    local speed = data.speed
    local entity = self:getEntityByUid(uid)
    if entity then
        local animationComponent = entity:getAnimationComponent()
        --BattleLog.errorTable(animationComponent)
        self:setSpeed(animationComponent,speed)
        self:crossFade(animationComponent,aniState,isReset)
        entity:setAnimationComponent(aniState,speed)
    end
end




return AnimatorSystem