---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by liuyubao.
--- DateTime: 2021/12/30 16:22
---@class ChangeRenderLayerSystem:ISystem
local ChangeRenderLayerSystem = SimpleClassUtil:class(ISystem)

function ChangeRenderLayerSystem:initialize()
    ISystem.initialize(self)
end

function ChangeRenderLayerSystem:getEventHandleMap()
    return {
        [EventType.Event_Battle_BlackOut]         = "blackoutHandle",

    }
end

function ChangeRenderLayerSystem:blackoutHandle(data)
    local uid = data.uid
    local entity = self:getEntityByUid(uid)
    if entity then
        local list_allMeshRender = entity:getAllSkinnedMeshRenderComponent()
        Logger.ErrorTable(list_allMeshRender)
        for i, meshRender in ipairs(list_allMeshRender) do
            meshRender.sortingLayerName = data.openType == Enum_Battle.SkillBlackOut.Open
                    and BattleConstant.RoleShow or BattleConstant.RoleMask
            local materials = meshRender.materials
            for _, material in pairs(materials) do
                material.renderQueue = data.openType == Enum_Battle.SkillBlackOut.Open
                        and BattleConstant.RoleShowRenderQueue or BattleConstant.RoleMaskRenderQueue
            end
        end
    end
end




return ChangeRenderLayerSystem