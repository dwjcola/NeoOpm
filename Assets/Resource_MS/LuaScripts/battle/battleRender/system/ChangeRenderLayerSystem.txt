---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by liuyubao.
--- DateTime: 2021/12/30 16:22
---@class ChangeRenderLayerSystem:ISystem
local ChangeRenderLayerSystem = SimpleClassUtil:class(ISystem)

function ChangeRenderLayerSystem:initialize()
    ISystem.initialize(self)
end

function ChangeRenderLayerSystem:getEventHandleMap()
    return {
        [EventType.Event_Battle_BlackOut]         = "blackoutHandle",
    }
end

function ChangeRenderLayerSystem:blackoutHandle(data)
    local uid = data.uid
    local entity = self:getEntityByUid(uid)
    if entity then
        local csArray_allMeshRender = entity:getAllSkinnedMeshRenderComponent()
        if csArray_allMeshRender then
            for i = 0, csArray_allMeshRender.Length -1 do
                local tmpMeshRender = csArray_allMeshRender[i]
                if tmpMeshRender then
                    tmpMeshRender.sortingLayerName = data.openType == Enum_Battle.SkillBlackOut.Open
                            and BattleConstant.RoleShow or BattleConstant.RoleMask
                    local materials = tmpMeshRender.materials
                    for h = 0, materials.Length -1 do
                        local material = materials[h]
                        material.renderQueue = data.openType == Enum_Battle.SkillBlackOut.Open
                                and BattleConstant.RoleShowRenderQueue or BattleConstant.RoleMaskRenderQueue
                    end

                end
            end
        end

    end
end




return ChangeRenderLayerSystem