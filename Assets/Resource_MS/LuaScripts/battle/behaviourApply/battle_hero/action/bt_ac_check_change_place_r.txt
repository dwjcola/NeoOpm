---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by liuyubao.
--- DateTime: 2022/1/12 21:41
---@class bt_ac_check_change_place_r:IAction
local bt_ac_check_change_place_r = SimpleClassUtil:class(IAction)

---@param blackBoard BlackBoard_BattleBase
function bt_ac_check_change_place_r:doAction(blackBoard,agent)
    local check_r = blackBoard._detection_r
    --- @type BattleEntityContext
    local _entityContext = agent._entityContext
    local self_entityList = _entityContext:getEntityListByCamp(blackBoard._campType)
    local len = 0
    for i, entity in pairs(self_entityList) do
        if entity:getData()._uid ~= blackBoard._uid then
            local entity_pos = entity:getData()._position
            local dis = Vector3.Distance(blackBoard._position,entity_pos)
            if dis < check_r then
                len = len + 1
            end
        end
    end
    local changeDelegate = function()
        if GameStatic_Battle.General_Grizmo then
            local data = {uid = blackBoard._uid,
                          volume_r = blackBoard._volume_r,
                          place_r = blackBoard._place_r,
                          dislocation_r = blackBoard._dislocation_r,
                          detection_r = blackBoard._detection_r,
                          attack_r = blackBoard._skillData[Enum_Battle.SkillTag.Skill_5]._skill_r,
                          place_r_base = blackBoard._place_r_base}
            EventManager:Dispatch_battle(EventType.Event_Battle_Render_Debug_GizmosCircle,data)
        end
    end
    if len == 0 then
        blackBoard._place_r =  blackBoard._place_r_base
    elseif len == 1 then
        blackBoard._place_r =  blackBoard._place_r_base * 0.66
    elseif len == 2 then
        blackBoard._place_r =  blackBoard._place_r_base * 0.5
    else
        blackBoard._place_r =  blackBoard._place_r_base * 0.33
    end

    changeDelegate()
    return Enum_BT.Node_ResultType.Success
end

return bt_ac_check_change_place_r