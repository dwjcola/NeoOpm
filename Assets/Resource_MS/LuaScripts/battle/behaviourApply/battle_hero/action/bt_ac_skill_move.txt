---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by liuyubao.
--- DateTime: 2022/2/16 18:16
---@class bt_ac_skill_move
local bt_ac_skill_move = SimpleClassUtil:class(IAction)

function bt_ac_skill_move:initialize()

end

function bt_ac_skill_move:initData(data)
   self._frameCount = 0
end
---@param blackBoard BlackBoard_BattleBase
---@param agent Agent
function bt_ac_skill_move:doAction(blackBoard,agent,dt)
    local result = Enum_BT.Node_ResultType.Fail
    if blackBoard and blackBoard._skill_moveFrame > 0 and blackBoard._skill_moveSpeed ~= 0 then
        self._frameCount =  self._frameCount + 1
        if self._frameCount > blackBoard._skill_moveFrame then
            self._frameCount = 0
            result = Enum_BT.Node_ResultType.Success
        else
            local moveVec = blackBoard._orientation == Enum_Battle.Orientation.Left
                    and Vector3.left * blackBoard._skill_moveSpeed or Vector3.right * blackBoard._skill_moveSpeed
            local self_pos = blackBoard._position
            local newPos = self_pos + moveVec
            --- @type PVE_Config_Battle_Manager
            local battleManager = agent._battleManager
            local data = {uid = blackBoard._uid,newPos = newPos,time = battleManager:getSpeedInterval()}
            EventManager:Dispatch_battle(EventType.Event_Battle_Render_Move_Line,data)
            blackBoard._position = newPos
            result = Enum_BT.Node_ResultType.Running
        end
    else
        self._frameCount = 0
    end
    return result
end

return bt_ac_skill_move