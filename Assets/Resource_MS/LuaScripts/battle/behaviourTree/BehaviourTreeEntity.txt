---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by liuyubao.
--- DateTime: 2021/12/9 15:03
--- 行为树黑板
---@class BehaviourTreeEntity:MiddleClass
local BehaviourTreeEntity = SimpleClassUtil:class()

function BehaviourTreeEntity:initialize(treeData,data,agent)
    ---@type BlackBoard_BattleBase
    self._blackboard = BlackBoard_BattleBase:new()
    self:initBlackBoard(data)
    self._agent = agent


   ---@type NodeBase
   self._rootNode = self:initTree(treeData,self._blackboard,agent)

end

function BehaviourTreeEntity:initBlackBoard(data)
    for i, v in pairs(data) do
        self._blackboard[i] = v
    end
end

function BehaviourTreeEntity:initTree(treeData,blackboard,agent)
    --self._rootNode = BehaviourAnalysis:Analysis(treeData,blackboard,agent)
    self._rootNode = CreateUtils:createTree("hero101",{},{})

    if self._rootNode == nil then
        Logger.Error("行为树 初始化失败")
    end
    return self._rootNode
end

function BehaviourTreeEntity:getBlackBoard()
    return self._blackboard
end

function BehaviourTreeEntity:getRootNode()
    return self._rootNode
end

function BehaviourTreeEntity:execute(dt)
    if self._rootNode then
        self._rootNode:prePosition()
        local  resultType = self._rootNode:execute(self._blackboard, self._agent)
        self._rootNode:postPosition(resultType)
    end
end

function BehaviourTreeEntity:clear()
    if self._rootNode then
        self._rootNode:postPosition(Enum_BT.Node_ResultType.Fail)
    end
end
return BehaviourTreeEntity