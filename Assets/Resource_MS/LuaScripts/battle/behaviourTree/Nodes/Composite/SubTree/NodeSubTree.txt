---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by lyb.
--- DateTime: 2021/12/8 1:02
---  子树


---@class NodeSubTree : NodeComposite
local NodeSubTree = SimpleClassUtil:class(NodeComposite)

function NodeSubTree:initialize()
    NodeComposite.initialize(self,Enum_BT.Node_Type.Sub_Tree)
    ---@type NodeBase
    self._lastRunningNode = nil
end

function NodeSubTree:onEnter()
    NodeComposite.onEnter(self)
end

function NodeSubTree:onExit()
    NodeComposite.onExit(self)
    if self._lastRunningNode then
        self._lastRunningNode:postPosition(Enum_BT.Node_ResultType.Fail)
        self._lastRunningNode = nil
    end
end


function NodeSubTree:execute(blackboard,agent,dt)
    self:log_enter("NodeSubTree    Entity: ",self:getEntityId())
    local resultType = Enum_BT.Node_ResultType.Fail
    if self:getChildesCount() <= 0 then
        return resultType
    end
    local nodeBase = self:getChildesByIndex(1)
    nodeBase:prePosition()
    resultType = nodeBase:execute(blackboard,agent,dt)
    nodeBase:postPosition(resultType)

    if resultType == Enum_BT.Node_ResultType.Running then
        self._lastRunningNode = nodeBase
    end
    self:log("NodeSubTree    Entity: ",self:getEntityId(),    "  resultType :", resultType)
    return resultType
end


return NodeSubTree