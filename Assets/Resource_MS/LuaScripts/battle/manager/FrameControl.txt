--- 收集客户段操作帧
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by liuyubao.
--- DateTime: 2022/3/1 10:49
--- @class FrameControl
local FrameControl = SimpleClassUtil:class()

function FrameControl:initialize()
    self._frameCount = 0
   ---@type FrameData[][]
   self._map_frameData_client = {}
    ---@type FrameData[][]
    self._map_frameData_server = {}
end

function FrameControl:setServerFrameData(data)
    self._map_frameData_server = data or {}
end

function FrameControl:disPatchEventMsg(eventKey,param)
   EventManager:Dispatch_battle(eventKey, param)
   self:addFrameDataList(self:createFrameData(eventKey, param))
end

function FrameControl:createFrameData(eventKey,data)
   return FrameData:new(self._frameCount,eventKey,data)
end

function FrameControl:getFrameDataList(frame)
   return self._map_frameData_client[frame] or {}
end
---@param frameData FrameData
function FrameControl:addFrameDataList(frameData)
    if self._map_frameData_client[frameData._frame] == nil then
        self._map_frameData_client[frameData._frame] = {}
    end
    table.insert(self._map_frameData_client[frameData._frame],frameData)
end

function FrameControl:update()
    self._frameCount =  self._frameCount + 1
    local frameDataList = self._map_frameData_server[self._frameCount]
    if frameDataList then
        for _, frameData in ipairs(frameDataList) do
            EventManager:Dispatch_battle(frameData._eventId, frameData._data)
        end
    end
end

function FrameControl:release()
    -- todo 释放逻辑
end

return FrameControl