---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by liuyubao.
--- DateTime: 2021/12/13 15:30
---
---@class PVE_Config_Battle_Manager:MiddleClass
local PVE_Config_Battle_Manager = Class("PVE_Config_Battle_Manager")

function PVE_Config_Battle_Manager:initialize(data)
    -- todo 检查 data 合法性
    self._data = data or {}
    ---@type boolean 是否只跑逻辑
    self._isOnlyLogic = self._data.isOnlyLogic or false
end

function PVE_Config_Battle_Manager:beginBattle()
    if self._isOnlyLogic then
        self:proLoadEnd()
    else
        ---@type BattleLoader
        self._battleLoader = BattleLoader:new(self._data)
        self._battleLoader:proLoad(function()
            self:proLoadEnd()
        end)
    end

end

--- 这里 开始正式的逻辑
function PVE_Config_Battle_Manager:proLoadEnd()
    self:formalInit(self._data)
end

function PVE_Config_Battle_Manager:formalInit(data)

    ---@type BlackBoard
    self._blackBoard = BlackBoard:new()

    if not self._isOnlyLogic then
        self._battleRenderContext = BattleRenderWorld:new(data,self._battleLoader)
        self._world_render = BattleRenderWorld:new(self._battleRenderContext)
    end


    self._battleLogicContext = BattleLogicContext:new(data)
    self._world_logic = BattleLogicWorld:new(self._battleLogicContext)


    ---@type BattleTeam
    self._team_self = BattleTeam:new( {
        teamData = self._data.teamSelf,
        go_root = self._battleLoader._go_left,
        list_ski = self._battleLoader._list_left_ski,
        blackBoard = self._blackBoard,
    } )
    ---@type BattleTeam
    self._team_enemy = BattleTeam:new({
        teamData = self._data.teamEnemy,
        go_root = self._battleLoader._go_right,
        list_ski = self._battleLoader._list_right_ski,
        blackBoard = self._blackBoard,
    } )






    --local treeData = btConfigMap:getClass("bt_con_battle_process")
   -- ---@type BehaviourTreeEntity
    --self._bt_battle_process = BehaviourAnalysis:Analysis(treeData.body(),self._blackBoard,self)
end

function PVE_Config_Battle_Manager:update(dt,timeScale)
    --if self._bt_battle_process then
    --    self._bt_battle_process:execute()
    --end
end

return PVE_Config_Battle_Manager

