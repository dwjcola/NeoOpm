---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by WangYunFei.
--- DateTime: 2018/9/30 16:48
---
---循环列表demo
---@class UIScrollViewLoopDemoMediator:BasePushViewMediator
UIScrollViewLoopDemoMediator = class("UIScrollViewLoopDemoMediator", BasePushViewMediator, _M)
require("dk.core.view.UIScrollViewLoopDemoListItem")
function UIScrollViewLoopDemoMediator:initialize()
    super.initialize(self)
    self._prefabItem =nil
    self._scrollView =nil
    ---@type UIScrollViewLoopDemoListItem[]
    self._items ={}
end

function UIScrollViewLoopDemoMediator:dispose()
    super.dispose(self)

end
function UIScrollViewLoopDemoMediator:getPanelType()
   return UIViewType.PushView
end
function UIScrollViewLoopDemoMediator:didShowWithData(data)
    self:initList()
end

function UIScrollViewLoopDemoMediator:onRegister()
    super:onRegister()
    local view = self:getView()
    self._btClose = view:getChild("Image_TopBg/Button_Close","Button")
    view:setClick(self._btClose,function ()
        self:onClose()
    end)

    ---获取循环列表组件
    self._scrollViewTran =view:getChild("tween/Vertical Scroll View")
    self._scrollView =LuaHelper.GetComponent(self._scrollViewTran.gameObject,"lufeigame.VScrollViewLoop")
    self._prefabItemTran =view:getChild("tween/Vertical Scroll View/Viewport/Content/item")
    self._prefabItem = LuaHelper.GetComponent(self._prefabItemTran.gameObject,"lufeigame.ScrollViewLuaItem")
    ---注册回调事件
    self._prefabItem:RegisterInitFunction(function (item)
        self:initItem(item)
    end)
    self._prefabItem:RegisterUpdataFunction(function (item,index)
        self:updateData(item,index)
    end)
end

function UIScrollViewLoopDemoMediator:initList()
    ---用lua数组来保存一对一的c#item对象和lua item对象的关联
    self._items={}
    ---初始化列表
    self._scrollView:SetCount(500)
    self._scrollView:ReLoad()
end
function UIScrollViewLoopDemoMediator:onClose()
    self:close()
end
---初始化 item组件
function UIScrollViewLoopDemoMediator:initItem(item)
  --logError(item:GetHashCode())
    ---通过c#对象唯一标识 建立与lua item对象之间的关系
    self._items[tostring(item:GetHashCode())] =UIScrollViewLoopDemoListItem:new(self,item.transform)

end
---更新某个item 数据
function UIScrollViewLoopDemoMediator:updateData(item,index)
    self._items[tostring(item:GetHashCode())]:setData(index)
end
